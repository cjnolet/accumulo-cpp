<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Accumulo++ by cjnolet</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Accumulo++</h1>
        <h2>A C++ Client for Accumulo</h2>
        <a href="https://github.com/cjnolet/accumulo-cpp" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>Why a C++ Library for Accumulo?</h1>

<p>Simple- When I'm running logic in InfoSphere Streams, I'd like to talk to Accumulo in C/C++. If I'm running code that needs to utilize CUDA and the GPU, I'd like to stay in C/C++ also. In Accumulo 1.5, we were given an Apache Thrift-based proxy that allows us to generate clients in differing languages. This is one such client which has been augmented to look as close as possible to the Java-based API that we've all come to know and love.</p>

<h1>Requirements</h1>

<ol>
<li>A running Accumulo cluster</li>
<li>The new Accumulo Thrift Proxy server (1.6 included in this codebase)</li>
<li>Thrift C++ library installed (<a href="http://thrift.apache.org/docs/install/">http://thrift.apache.org/docs/install/</a>)</li>
</ol><h1>Quick Start</h1>

<ol>
<li>You'll need to run the Accumulo Thrift Proxy server. A jar is packaged with this codebase in order to get this started quickly. Locate the server/proxy.properties file and fill in the necessary fields. When you are done, start up the server by running the following:
<code>
./server/runProxy.sh
</code>
</li>
<li>Build the example programs:
<code>
make
</code>
</li>
<li>Create an example table using the CreateTable example program
<code>
./target/CreateTableExample.o localhost 42424 root secret testTable
</code>
</li>
<li>Run the BatchWriter example program to insert some rows into Accumulo:
<code>
./target/BatchWriterExample.o localhost 42424 root secret testTable row1 col1 qual6 U val
</code>
</li>
<li>Run the Scanner example program to read rows from Accumulo:
<code>
./target/ScannerExample.o localhost 42424 root secret testTable A z
</code>
</li>
</ol><h1>Code Samples</h1>

<h2>TableOperations Sample</h2>

<div class="highlight"><pre>
<span class="n">try</span> <span class="p">{</span>
    <span class="n">Conector</span> <span class="n">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>
    <span class="n">connector</span><span class="p">.</span><span class="n">tableOperations</span><span class="p">().</span><span class="n">createTable</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">);</span>
    <span class="n">connector</span><span class="p">.</span><span class="n">tableOperations</span><span class="p">().</span><span class="n">compactTable</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">);</span>
    <span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">AccumuloSecurityException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"There was a problem with the given credentials.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">TableNotFoundException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The specified table was not found.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>

<h2>BatchWriter Sample</h2>

<div class="highlight"><pre>
<span class="n">try</span> <span class="p">{</span>
    <span class="n">Connector</span> <span class="n">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>
    <span class="n">BatchWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">createBatchWriter</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

    <span class="n">Mutation</span> <span class="nf">mutation</span><span class="p">(</span><span class="s">"rowId"</span><span class="p">);</span>
    <span class="n">mutation</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"colFam"</span><span class="p">,</span> <span class="s">"colQual"</span><span class="p">,</span> <span class="s">"colVis"</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="s">"val"</span><span class="p">);</span>

    <span class="n">writer</span><span class="p">.</span><span class="n">addMutation</span><span class="p">(</span><span class="n">mutation</span><span class="p">);</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

    <span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">AccumuloSecurityException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"There was a problem with the given credentials.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">TException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"An error occurred: the mutation was not written to the table.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h2>Scanner Sample</h2>

<div class="highlight"><pre>

<span class="n">try</span> <span class="p">{</span>
    <span class="n">Connector</span> <span class="n">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>

    <span class="n">Authorizations</span> <span class="nf">auths</span><span class="p">(</span><span class="s">"A,B"</span><span class="p">);</span>
    <span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">createScanner</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">,</span> <span class="n">auths</span><span class="p">);</span>

    <span class="c1">// Set up the range</span>
    <span class="n">Key</span> <span class="nf">start</span><span class="p">(</span><span class="s">"A"</span><span class="p">);</span>
    <span class="n">Key</span> <span class="nf">stop</span><span class="p">(</span><span class="s">"z"</span><span class="p">);</span>
    <span class="n">Range</span> <span class="nf">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">);</span>

    <span class="n">scanner</span><span class="p">.</span><span class="n">setRange</span><span class="p">(</span><span class="n">range</span><span class="p">);</span>
    <span class="n">scanner</span><span class="p">.</span><span class="n">fetchColumn</span><span class="p">(</span><span class="s">"department"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>

    <span class="n">ScannerIterator</span> <span class="n">itr</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="n">iterator</span><span class="p">();</span>

    <span class="k">while</span><span class="p">(</span><span class="n">itr</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">KeyValue</span> <span class="n">kv</span> <span class="o">=</span> <span class="n">itr</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getRow</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColFamily</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">":"</span> 
                 <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColQualifier</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" ["</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColVisibility</span><span class="p">()</span> 
                 <span class="o">&lt;&lt;</span> <span class="s">"] "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getTimestamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">itr</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">AccumuloSecurityException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"There was a problem with the given credentials.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">TableNotFoundException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The specified table was not found.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>

<h2>BatchScanner Example</h2>

<div class="highlight"><pre>
<span class="n">try</span> <span class="p">{</span>
    <span class="n">Connector</span> <span class="n">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>

    <span class="n">Authorizations</span> <span class="nf">auths</span><span class="p">(</span><span class="s">"A,B"</span><span class="p">);</span>    
    <span class="n">BatchScanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">createBatchScanner</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="c1">// construct ranges</span>
    <span class="n">Range</span> <span class="nf">range1</span><span class="p">(</span><span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"A"</span><span class="p">),</span> <span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"Z"</span><span class="p">);</span>
    <span class="n">Range</span> <span class="nf">range2</span><span class="p">(</span><span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"a"</span><span class="p">),</span> <span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"z"</span><span class="p">);</span>

    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Range</span><span class="o">&gt;</span> <span class="n">ranges</span><span class="p">;</span>
    <span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">range1</span><span class="p">);</span>
    <span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">range2</span><span class="p">);</span>

    <span class="n">scanner</span><span class="p">.</span><span class="n">setRanges</span><span class="p">(</span><span class="n">ranges</span><span class="p">);</span>
    <span class="n">scanner</span><span class="p">.</span><span class="n">fetchColumn</span><span class="p">(</span><span class="s">"department"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>

    <span class="n">BatchScannerIterator</span> <span class="n">itr</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="n">iterator</span><span class="p">();</span>

    <span class="k">while</span><span class="p">(</span><span class="n">itr</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span> <span class="p">{</span>

        <span class="n">KeyValue</span> <span class="n">kv</span> <span class="o">=</span> <span class="n">itr</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getRow</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColFamily</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">":"</span> 
             <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColQualifier</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" ["</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColVisibility</span><span class="p">()</span> 
             <span class="o">&lt;&lt;</span> <span class="s">"] "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getTimestamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">itr</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
    <span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">AccumuloSecurityException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"There was a problem with the given credentials.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">TableNotFoundException</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"The specified table was not found.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/cjnolet/accumulo-cpp/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/cjnolet/accumulo-cpp/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/cjnolet/accumulo-cpp"></a> is maintained by <a href="https://github.com/cjnolet">cjnolet</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>