<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Accumulo++ by cjnolet</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Accumulo++</h1>
        <p>A C++ Implementation of the Accumulo Thrift Proxy</p>

        <p class="view"><a href="https://github.com/cjnolet/accumulo-cpp">View the Project on GitHub <small>cjnolet/accumulo-cpp</small></a></p>


        <ul>
          <li><a href="https://github.com/cjnolet/accumulo-cpp/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/cjnolet/accumulo-cpp/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/cjnolet/accumulo-cpp">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>Why a C++ Library for Accumulo?</h2>

<p>Simple- When I'm running logic in InfoSphere Streams, I'd like to talk to Accumulo in C/C++. If I'm running code that needs to utilize CUDA and the GPU, I'd like to stay in C/C++ also. In Accumulo 1.5, we were given an Apache Thrift-based proxy that allows us to generate clients in differing languages. This is one such client which has been augmented to look as close as possible to the Java-based API that we've all come to know and love.</p>

<h2>Requirements</h2>

<ol>
<li>A running Accumulo cluster</li>
<li>The new Accumulo Thrift Proxy server (1.6 included in this codebase)</li>
<li>Thrift C++ library installed (<a href="http://thrift.apache.org/docs/install/">http://thrift.apache.org/docs/install/</a>)</li>
</ol><h2>Quick Start</h2>

<ol>
<li>You'll need to run the Accumulo Thrift Proxy server. A jar is packaged with this codebase in order to get this started quickly. Locate the server/proxy.properties file and fill in the necessary fields. When you are done, start up the server by running the following:
<code>
./server/runProxy.sh
</code>
</li>
<li>Build the example programs:
<code>
make
</code>
</li>
<li>Create an example table using the CreateTable example program
<code>
./target/CreateTableExample.o localhost 42424 root secret testTable
</code>
</li>
<li>Run the BatchWriter example program to insert some rows into Accumulo:
<code>
./target/BatchWriterExample.o localhost 42424 root secret testTable row1 col1 qual6 U val
</code>
</li>
<li>Run the Scanner example program to read rows from Accumulo:
<code>
./target/ScannerExample.o localhost 42424 root secret testTable A z
</code>
</li>
</ol><h2>Code Samples</h2>

<h3>BatchWriter Sample</h3>

<div class="highlight"><pre><span class="n">Connector</span> <span class="nf">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>
<span class="n">BatchWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">createBatchWriter</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="n">Mutation</span> <span class="nf">mutation</span><span class="p">(</span><span class="s">"rowId"</span><span class="p">);</span>
<span class="n">mutation</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s">"colFam"</span><span class="p">,</span> <span class="s">"colQual"</span><span class="p">,</span> <span class="s">"colVis"</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="s">"val"</span><span class="p">);</span>

<span class="n">writer</span><span class="p">.</span><span class="n">addMutation</span><span class="p">(</span><span class="n">mutation</span><span class="p">);</span>
<span class="n">writer</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
<span class="n">writer</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>

<span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</pre></div>

<h3>Scanner Sample</h3>

<div class="highlight"><pre><span class="n">Connector</span> <span class="nf">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>

<span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">auths</span><span class="p">;</span>
<span class="n">auths</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">"U"</span><span class="p">);</span>

<span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">createScanner</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">,</span> <span class="n">auths</span><span class="p">);</span>

<span class="c1">// Set up the range</span>
<span class="n">Key</span> <span class="nf">start</span><span class="p">(</span><span class="s">"A"</span><span class="p">);</span>
<span class="n">Key</span> <span class="nf">stop</span><span class="p">(</span><span class="s">"z"</span><span class="p">);</span>
<span class="n">Range</span> <span class="nf">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">);</span>

<span class="n">scanner</span><span class="p">.</span><span class="n">setRange</span><span class="p">(</span><span class="n">range</span><span class="p">);</span>
<span class="n">scanner</span><span class="p">.</span><span class="n">fetchColumn</span><span class="p">(</span><span class="s">"department"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>

<span class="n">ScannerIterator</span> <span class="n">itr</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="n">iterator</span><span class="p">();</span>

<span class="k">while</span><span class="p">(</span><span class="n">itr</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">KeyValue</span> <span class="n">kv</span> <span class="o">=</span> <span class="n">itr</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getRow</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColFamily</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">":"</span> 
             <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColQualifier</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" ["</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColVisibility</span><span class="p">()</span> 
             <span class="o">&lt;&lt;</span> <span class="s">"] "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getTimestamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="p">}</span>

<span class="n">itr</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</pre></div>

<h3>BatchScanner Example</h3>

<div class="highlight"><pre>
<span class="n">Connector</span> <span class="nf">connector</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="s">"root"</span><span class="p">,</span> <span class="s">"secret"</span><span class="p">);</span>

<span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">auths</span><span class="p">;</span>
<span class="n">auths</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">"U"</span><span class="p">);</span>

<span class="n">BatchScanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">connector</span><span class="p">.</span><span class="n">createBatchScanner</span><span class="p">(</span><span class="s">"testTable"</span><span class="p">,</span> <span class="n">auths</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="c1">// construct ranges</span>
<span class="n">Range</span> <span class="nf">range1</span><span class="p">(</span><span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"A"</span><span class="p">),</span> <span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"Z"</span><span class="p">);</span>
<span class="n">Range</span> <span class="nf">range2</span><span class="p">(</span><span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"a"</span><span class="p">),</span> <span class="k">new</span> <span class="n">Key</span><span class="p">(</span><span class="s">"z"</span><span class="p">);</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Range</span><span class="o">&gt;</span> <span class="n">ranges</span><span class="p">;</span>
<span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">range1</span><span class="p">);</span>
<span class="n">ranges</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">range2</span><span class="p">);</span>

<span class="n">scanner</span><span class="p">.</span><span class="n">setRanges</span><span class="p">(</span><span class="n">ranges</span><span class="p">);</span>
<span class="n">scanner</span><span class="p">.</span><span class="n">fetchColumn</span><span class="p">(</span><span class="s">"department"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>

<span class="n">BatchScannerIterator</span> <span class="n">itr</span> <span class="o">=</span> <span class="n">scanner</span><span class="p">.</span><span class="n">iterator</span><span class="p">();</span>

<span class="k">while</span><span class="p">(</span><span class="n">itr</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span> <span class="p">{</span>

    <span class="n">KeyValue</span> <span class="n">kv</span> <span class="o">=</span> <span class="n">itr</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getRow</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColFamily</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">":"</span> 
         <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColQualifier</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" ["</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getColVisibility</span><span class="p">()</span> 
         <span class="o">&lt;&lt;</span> <span class="s">"] "</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getKey</span><span class="p">().</span><span class="n">getTimestamp</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">&lt;&lt;</span> <span class="n">kv</span><span class="p">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="p">}</span>

<span class="n">itr</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="n">connector</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
</pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/cjnolet">cjnolet</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>